var blockly_mario;(function(){function n(n,t,e){return Blockly.JavaScript.valueToCode(n,t,e)}Blockly.Language.agent_act={init:function(){this.setColour(290),this.appendDummyInput().appendTitle("activate"),this.appendValueInput("ACTION"),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip("")}},Blockly.Language.agent_action={init:function(){this.setColour(160),this.appendDummyInput().appendTitle(new Blockly.FieldDropdown([["jump","jump"],["shoot","shoot"],["left","left"],["right","right"],["up","up"],["down","down"]]),"VALUE"),this.setInputsInline(!0),this.setOutput(!0,String),this.setTooltip("")}},Blockly.JavaScript.agent_act=function(){var t=n(this,"ACTION",Blockly.JavaScript.ORDER_NONE),e=["$$actions[",t,"] = true;\n"].join("");return e},Blockly.JavaScript.agent_action=function(){var n='"'+this.getTitleValue("VALUE")+'"';return[n,Blockly.JavaScript.ORDER_ATOMIC]}})(blockly_mario||(blockly_mario={}));var blockly_mario;(function(blockly_mario){function $(n){return document.getElementById(n)}function $input(n){return $(n)}function copySimpleShallow(n){var t={};for(var e in n)t[e]=n[e];return t}function defineFinishCode(n){return function(t){return n(["return function() {","var $$actions = {};",t,"return $$actions;","};"].join("\n"))}}function defineKeyDown(n){return function(t){if(this.IsActive()&&32==t.keyCode){var e=$input("pause");e.checked=!e.checked,handlePause()}else n.call(this,t)}}function handlePause(){$input("pause").checked?application.timer.Stop():application.timer.Start()}function redefine(n,t,e){n[t]=e(n[t])}function updateCode(){var code=Blockly.Generator.workspaceToCode("JavaScript");code=["(function() {",code,"})"].join("\n");try{aiFunction=eval(code)(),$input("ai").disabled=!1}catch(e){throw alert("Error building code."),aiFunction=null,$input("ai").checked=!1,$input("ai").disabled=!0,e}}var aiFunction,application;window.onload=function(){application=new Enjine.Application,application.Initialize(new Mario.LoadingState("../mariohtml5/"),320,240),application.timer.UpdateObject=new AiUpdate(application),redefine(Enjine.KeyboardInput,"KeyDownEvent",defineKeyDown),Blockly.inject($("blockly"),{path:"../blockly/",toolbox:$("toolbox")}),redefine(Blockly.JavaScript,"finish",defineFinishCode),$("ai").onclick=function(){$input("ai").checked||$("canvas").focus()},$input("pause").checked=!1,$("pause").onclick=handlePause,$("update").onclick=updateCode,$input("ai").disabled=!0};var AiUpdate=function(){function n(n){this.base=n}return n.prototype.Update=function(n){var t,e=$input("ai").checked&&Boolean(aiFunction);if(e){var i=aiFunction(),o={},a={down:"Down",left:"Left",jump:"S",right:"Right",shoot:"A",up:"Up"};for(var c in i)i[c]&&(o[Enjine.Keys[a[c]]]=!0);t=Enjine.KeyboardInput.Pressed,Enjine.KeyboardInput.Pressed=o,Enjine.KeyboardInput.Element=null}this.base.Update(n),e&&(Enjine.KeyboardInput.Pressed=t,Enjine.KeyboardInput.Element=$("canvas"))},n}()})(blockly_mario||(blockly_mario={}));